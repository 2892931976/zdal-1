<?xml version="1.0" encoding="gb2312"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">

<beans default-autowire="byName">
	<bean id="root" class="com.taobao.tddl.common.config.beans.AppRule"
		init-method="init">
		<property name="masterRule" ref="rwRule" />
		<property name="slaveRule" ref="rwRule" />
	</bean>
	<bean id="rwRule" class="com.taobao.tddl.common.config.beans.ShardRule">
		<!-- 数据库类型为mysql -->
		<property name="dbtype" value="MYSQL" />
		<property name="tableRules">
			<map>
				<entry key="card_no_month" value-ref="sharding_rule" />
			</map>
		</property>
	</bean>

	<!-- 根据influxId分库分表规则 -->
	<bean id="sharding_rule" init-method="init"
		class="com.taobao.tddl.common.config.beans.TableRule">
		
	<property name="dbIndexes" value="db_0,db_1,db_2,db_3" />
		<!--  分库规则 -->
		<property name="dbRuleArray">
			<list>
				<value>Integer.valueOf(#card_no#.substring(9,10),10) % 4;</value>
			</list>
		</property>

		<!-- 分表规则--> 
		<property name="tbRuleArray">
			<list>
				<value>Integer.valueOf(#card_no#.substring(9,10),10) % 2 * 12 + #gmtTime,1_month,12#.getAt(Calendar.MONTH)</value>
			</list>
		</property>	
			<property name="shardingRules">
		   <list>
		      <value>Integer.valueOf(#card_no#.substring(9,10),10)%2;</value>
		    <!--   <value>Integer.valueOf(#card_no#)%10;</value> -->
		   </list>
		</property>	
		<!-- 表后缀 -->
	 	<property name="tbSuffix" value="twoColumnForEachDB:[_00-_01],[_00-_11]" />
		<property name="tbNumForEachDb" value="24"/>
		<property name="disableFullTableScan" value="true"/>
		</bean>
</beans>